
<!DOCTYPE html>
<html>
  <head>
    <title>i3 Patch: Respect workspace numbers when looking for a free workspace name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" media="screen" href="http://i3wm.org/css/style.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/public/stylesheets/main.css">
    <link rel="shortcut icon" type="image/png" href="http://i3wm.org/favicon.png">
    <script src="/public/js/jquery-1.9.0.min.js" type="text/javascript" charset="utf-8"></script>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
    
    
      <script src="/public/js/patch.js" type="text/javascript" charset="utf-8"></script>
    
  </head>
  <body>


<div id="main">
	<a href="/"><h1 id="title">i3 - improved tiling WM</h1></a>
				<ul id="nav">
						<li><a style="border-bottom: 2px solid #fff" href="/">Reviews</a></li>
						<li><a href="http://bugs.i3wm.org/">Bugs</a></li>
				</ul>
<br style="clear: both">

<div id="content">

<h1>Respect workspace numbers when looking for a free workspace name</h1>
<div style="float: right">
<p>
Patch status: merged
</p>
<p>
Patch by Sebastian Ullrich
</p>
</div>

<p>
<strong>Long description</strong>:<br>
<pre>This prevents a ws &#39;1&#39; appearing on a new output when there&#39;s
already a ws &#39;1: www&#39; on an existing output
</pre>
</p>


<p>
To apply this patch, use:<br>
<code>curl http://cr.i3wm.org/patch/202/raw.patch | git am</code>
</p>




<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/src/workspace.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L18">18</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="18">@@ -197,17 &#43;197,16 @@ Con *create_workspace_on_output(Output *output, Con *content) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L19">19</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="19">         while (exists) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L20">20</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="20">             c&#43;&#43;;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L21">21</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="21"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L22">22</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="22">-            FREE(ws-&gt;name);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L23">23</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="23">-            sasprintf(&amp;(ws-&gt;name), &#34;%d&#34;, c);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L24">24</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="24">&#43;            ws-&gt;num = c;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L25">25</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="25"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L26">26</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="26">             current = NULL;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L27">27</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="27">             TAILQ_FOREACH(out, &amp;(croot-&gt;nodes_head), nodes)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L28">28</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="28">-                GREP_FIRST(current, output_get_content(out), !strcasecmp(child-&gt;name, ws-&gt;name));</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L29">29</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="29">&#43;                GREP_FIRST(current, output_get_content(out), child-&gt;num == ws-&gt;num);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L30">30</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="30">             exists = (current != NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L31">31</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="31"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L32">32</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="32">-            DLOG(&#34;result for ws %s / %d: exists = %d\n&#34;, ws-&gt;name, c, exists);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L33">33</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="33">&#43;            DLOG(&#34;result for ws %d: exists = %d\n&#34;, c, exists);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L34">34</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="34">         }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L35">35</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="35">-        ws-&gt;num = c;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L36">36</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="36">&#43;        sasprintf(&amp;(ws-&gt;name), &#34;%d&#34;, c);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L37">37</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="37">     }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L38">38</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="38">     con_attach(ws, content, false);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L39">39</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="39"> </pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/testcases/t/515-create-workspace.t</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L45">45</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="45">@@ -0,0 &#43;1,40 @@</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L46">46</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="46">&#43;#!perl</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L47">47</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="47">&#43;# vim:ts=4:sw=4:expandtab</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L48">48</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="48">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L49">49</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="49">&#43;# Please read the following documents before working on tests:</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L50">50</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="50">&#43;# • http://build.i3wm.org/docs/testsuite.html</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L51">51</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="51">&#43;#   (or docs/testsuite)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L52">52</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="52">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L53">53</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="53">&#43;# • http://build.i3wm.org/docs/lib-i3test.html</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L54">54</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="54">&#43;#   (alternatively: perldoc ./testcases/lib/i3test.pm)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L55">55</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="55">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L56">56</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="56">&#43;# • http://build.i3wm.org/docs/ipc.html</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L57">57</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="57">&#43;#   (or docs/ipc)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L58">58</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="58">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L59">59</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="59">&#43;# • http://onyxneon.com/books/modern_perl/modern_perl_a4.pdf</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L60">60</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="60">&#43;#   (unless you are already familiar with Perl)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L61">61</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="61">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L62">62</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="62">&#43;# Tests that new workspace names are taken from the config,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L63">63</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="63">&#43;# then from the first free number starting with 1.</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L64">64</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="64">&#43;#</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L65">65</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="65">&#43;use i3test i3_autostart =&gt; 0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L66">66</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="66">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L67">67</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="67">&#43;my $config = &lt;&lt;EOT;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L68">68</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="68">&#43;# i3 config file (v4)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L69">69</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="69">&#43;font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L70">70</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="70">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L71">71</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="71">&#43;fake-outputs 1024x768&#43;0&#43;0,1024x768&#43;1024&#43;0</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L72">72</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="72">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L73">73</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="73">&#43;bindsym 1 workspace 1: eggs</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L74">74</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="74">&#43;EOT</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L75">75</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="75">&#43;my $pid = launch_with_config($config);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L76">76</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="76">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L77">77</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="77">&#43;my $i3 = i3(get_socket_path());</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L78">78</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="78">&#43;my $ws = $i3-&gt;get_workspaces-&gt;recv;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L79">79</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="79">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L80">80</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="80">&#43;is($ws-&gt;[0]-&gt;{name}, &#39;1: eggs&#39;, &#39;new workspace uses config name&#39;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L81">81</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="81">&#43;is($ws-&gt;[1]-&gt;{name}, &#39;2&#39;, &#39;naming continues with next free number&#39;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L82">82</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="82">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L83">83</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="83">&#43;exit_gracefully($pid);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L84">84</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="84">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L85">85</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="85">&#43;done_testing;</pre>
  </td>
  </tr>


</table>
</div>


</div>

  </body>
</html>

