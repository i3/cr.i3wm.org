
<!DOCTYPE html>
<html>
  <head>
    <title>i3 Patch: Remove references to PATH_MAX macro</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" media="screen" href="http://i3wm.org/css/style.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/public/stylesheets/main.css">
    <link rel="shortcut icon" type="image/png" href="http://i3wm.org/favicon.png">
    <script src="/public/js/jquery-1.9.0.min.js" type="text/javascript" charset="utf-8"></script>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
    
    
      <script src="/public/js/patch.js" type="text/javascript" charset="utf-8"></script>
    
  </head>
  <body>


<div id="main">
	<a href="/"><h1 id="title">i3 - improved tiling WM</h1></a>
				<ul id="nav">
						<li><a style="border-bottom: 2px solid #fff" href="/">Reviews</a></li>
						<li><a href="http://bugs.i3wm.org/">Bugs</a></li>
				</ul>
<br style="clear: both">

<div id="content">

<h1>Remove references to PATH_MAX macro</h1>
<div style="float: right">
<p>
Patch status: needinfo
</p>
<p>
Patch by Lancelot SIX
</p>
</div>

<p>
<strong>Long description</strong>:<br>
<pre>Since the macro PATH_MAX is not defined on every system (GNU/Hurd being
one of those who do not define it), we remove all references to this
macro. Instead, we use a buffer of arbitraty size and grow it when
needed to contain paths.
</pre>
</p>


<p>
To apply this patch, use:<br>
<code>curl http://cr.i3wm.org/patch/317/raw.patch | git am</code>
</p>




<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/i3-nagbar/main.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L23">23</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="23">@@ -159,8 &#43;159,9 @@ static void handle_button_release(xcb_connection_t *conn, xcb_button_release_eve</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L24">24</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="24">     fclose(script);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L25">25</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="25"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L26">26</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="26">     char *link_path;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L27">27</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="27">&#43;    char *exe_path = get_exe_path(argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L28">28</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="28">     sasprintf(&amp;link_path, &#34;%s.nagbar_cmd&#34;, script_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L29">29</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="29">-    symlink(get_exe_path(argv0), link_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L30">30</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="30">&#43;    symlink(exe_path, link_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L31">31</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="31"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L32">32</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="32">     char *terminal_cmd;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L33">33</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="33">     sasprintf(&amp;terminal_cmd, &#34;i3-sensible-terminal -e %s&#34;, link_path);</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L34">34</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="34">@@ -172,6 &#43;173,7 @@ static void handle_button_release(xcb_connection_t *conn, xcb_button_release_eve</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L35">35</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="35">     free(link_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L36">36</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="36">     free(terminal_cmd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L37">37</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="37">     free(script_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L38">38</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="38">&#43;    free(exe_path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L39">39</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="39"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L40">40</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="40">     /* TODO: unset flag, re-render */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L41">41</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="41"> }</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/i3bar/src/xcb.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L46">46</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="46">@@ -961,26 &#43;961,48 @@ char *init_xcb_early() {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L47">47</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="47">     get_atoms();</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L48">48</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="48"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L49">49</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="49">     xcb_get_property_cookie_t path_cookie;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L50">50</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="50">&#43;    xcb_get_property_reply_t *path_reply;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L51">51</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="51">&#43;    int len;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L52">52</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="52">&#43;    size_t path_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L53">53</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="53">&#43;    char *path = NULL;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L54">54</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="54">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L55">55</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="55">     path_cookie = xcb_get_property_unchecked(xcb_connection,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L56">56</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="56">-                                   0,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L57">57</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="57">-                                   xcb_root,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L58">58</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="58">-                                   atoms[I3_SOCKET_PATH],</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L59">59</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="59">-                                   XCB_GET_PROPERTY_TYPE_ANY,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L60">60</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="60">-                                   0, PATH_MAX);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L61">61</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="61">&#43;                                             0,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L62">62</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="62">&#43;                                             xcb_root,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L63">63</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="63">&#43;                                             atoms[I3_SOCKET_PATH],</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L64">64</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="64">&#43;                                             XCB_GET_PROPERTY_TYPE_ANY,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L65">65</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="65">&#43;                                             0,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L66">66</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="66">&#43;                                             (path_size / 4));</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L67">67</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="67"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L68">68</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="68">     /* We check, if i3 set its socket-path */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L69">69</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="69">-    xcb_get_property_reply_t *path_reply = xcb_get_property_reply(xcb_connection,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L70">70</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="70">-                                                                  path_cookie,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L71">71</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="71">-                                                                  NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L72">72</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="72">-    char *path = NULL;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L73">73</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="73">&#43;    path_reply = xcb_get_property_reply(xcb_connection,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L74">74</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="74">&#43;                                        path_cookie,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L75">75</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="75">&#43;                                        NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L76">76</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="76">     if (path_reply) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L77">77</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="77">-        int len = xcb_get_property_value_length(path_reply);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L78">78</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="78">&#43;        len = xcb_get_property_value_length(path_reply);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L79">79</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="79">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L80">80</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="80">&#43;        if (len &gt; 0 &amp;&amp; len &lt; path_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L81">81</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="81">&#43;            path_size &#43;= (path_reply-&gt;bytes_after / 4) &#43; 1;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L82">82</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="82">&#43;            path_cookie = xcb_get_property_unchecked(xcb_connection,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L83">83</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="83">&#43;                                                     0,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L84">84</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="84">&#43;                                                     xcb_root,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L85">85</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="85">&#43;                                                     atoms[I3_SOCKET_PATH],</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L86">86</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="86">&#43;                                                     XCB_GET_PROPERTY_TYPE_ANY,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L87">87</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="87">&#43;                                                     0,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L88">88</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="88">&#43;                                                     (path_size / 4));</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L89">89</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="89">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L90">90</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="90">&#43;            path_reply = xcb_get_property_reply(xcb_connection,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L91">91</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="91">&#43;                                                path_cookie,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L92">92</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="92">&#43;                                                NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L93">93</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="93">&#43;        }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L94">94</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="94">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L95">95</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="95">&#43;    if (path_reply) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L96">96</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="96">&#43;        len = xcb_get_property_value_length(path_reply);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L97">97</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="97">         if (len != 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L98">98</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="98">             path = strndup(xcb_get_property_value(path_reply), len);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L99">99</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="99">         }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L100">100</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="100">     }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L101">101</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="101"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L102">102</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="102">-</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L103">103</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="103">     if (xcb_request_failed(sl_pm_cookie, &#34;Could not allocate statusline-buffer&#34;) ||</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L104">104</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="104">         xcb_request_failed(clear_ctx_cookie, &#34;Could not allocate statusline-buffer-clearcontext&#34;) ||</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L105">105</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="105">         xcb_request_failed(sl_ctx_cookie, &#34;Could not allocate statusline-buffer-context&#34;)) {</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/include/libi3.h</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L110">110</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="110">@@ -369,7 &#43;369,8 @@ char *get_process_filename(const char *prefix);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L111">111</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="111">  *</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L112">112</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="112">  * The implementation follows http://stackoverflow.com/a/933996/712014</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L113">113</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="113">  *</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L114">114</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="114">&#43; * Returned value must be freed by the caller.</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L115">115</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="115">  */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L116">116</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="116">-const char *get_exe_path(const char *argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L117">117</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="117">&#43;char *get_exe_path(const char *argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L118">118</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="118"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L119">119</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="119"> #endif</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/libi3/get_exe_path.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L124">124</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="124">@@ -3,6 &#43;3,7 @@</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L125">125</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="125"> #include &lt;stdio.h&gt;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L126">126</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="126"> #include &lt;limits.h&gt;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L127">127</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="127"> #include &lt;stdlib.h&gt;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L128">128</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="128">&#43;#include &lt;errno.h&gt;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L129">129</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="129"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L130">130</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="130"> #include &#34;libi3.h&#34;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L131">131</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="131"> </pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L132">132</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="132">@@ -11,10 &#43;12,14 @@</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L133">133</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="133">  *</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L134">134</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="134">  * The implementation follows http://stackoverflow.com/a/933996/712014</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L135">135</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="135">  *</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L136">136</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="136">&#43; * Returned value must be freed by the caller.</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L137">137</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="137">  */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L138">138</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="138">-const char *get_exe_path(const char *argv0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L139">139</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="139">-	static char destpath[PATH_MAX];</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L140">140</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="140">-	char tmp[PATH_MAX];</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L141">141</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="141">&#43;char *get_exe_path(const char *argv0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L142">142</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="142">&#43;	size_t destpath_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L143">143</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="143">&#43;	size_t tmp_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L144">144</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="144">&#43;	char *destpath = smalloc(destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L145">145</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="145">&#43;	char *tmp = smalloc(tmp_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L146">146</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="146">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L147">147</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="147"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L148">148</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="148"> #if defined(__linux__) || defined(__FreeBSD__) || defined(__FreeBSD_kernel__)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L149">149</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="149"> 	/* Linux and Debian/kFreeBSD provide /proc/self/exe */</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L150">150</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="150">@@ -25,30 &#43;30,51 @@ const char *get_exe_path(const char *argv0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L151">151</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="151"> #endif</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L152">152</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="152"> 	ssize_t linksize;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L153">153</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="153"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L154">154</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="154">-	if ((linksize = readlink(exepath, destpath, sizeof(destpath) - 1)) != -1) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L155">155</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="155">&#43;	while ((linksize = readlink(exepath, destpath, destpath_size)) == destpath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L156">156</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="156">&#43;		destpath_size = destpath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L157">157</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="157">&#43;		destpath = srealloc(destpath, destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L158">158</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="158">&#43;	}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L159">159</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="159">&#43;	if (linksize != -1) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L160">160</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="160"> 		/* readlink() does not NULL-terminate strings, so we have to. */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L161">161</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="161"> 		destpath[linksize] = &#39;\0&#39;;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L162">162</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="162">-</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L163">163</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="163">&#43;		free(tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L164">164</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="164"> 		return destpath;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L165">165</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="165"> 	}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L166">166</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="166"> #endif</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L167">167</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="167"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L168">168</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="168"> 	/* argv[0] is most likely a full path if it starts with a slash. */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L169">169</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="169">-	if (argv0[0] == &#39;/&#39;)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L170">170</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="170">-		return argv0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L171">171</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="171">&#43;	if (argv0[0] == &#39;/&#39;) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L172">172</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="172">&#43;		free(tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L173">173</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="173">&#43;		free(destpath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L174">174</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="174">&#43;		return sstrdup(argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L175">175</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="175">&#43;	}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L176">176</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="176"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L177">177</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="177"> 	/* if argv[0] contains a /, prepend the working directory */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L178">178</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="178">-	if (strchr(argv0, &#39;/&#39;) != NULL &amp;&amp;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L179">179</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="179">-		getcwd(tmp, sizeof(tmp)) != NULL) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L180">180</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="180">-		snprintf(destpath, sizeof(destpath), &#34;%s/%s&#34;, tmp, argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L181">181</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="181">-		return destpath;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L182">182</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="182">&#43;	if (strchr(argv0, &#39;/&#39;) != NULL) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L183">183</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="183">&#43;		char *retgcwd;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L184">184</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="184">&#43;		while ((retgcwd = getcwd(tmp, tmp_size)) == NULL &amp;&amp; errno == ERANGE) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L185">185</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="185">&#43;			tmp_size = tmp_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L186">186</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="186">&#43;			tmp = srealloc(tmp, tmp_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L187">187</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="187">&#43;		}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L188">188</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="188">&#43;		if (retgcwd != NULL) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L189">189</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="189">&#43;			while (snprintf(destpath, destpath_size, &#34;%s/%s&#34;, tmp, argv0) &gt;= destpath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L190">190</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="190">&#43;				destpath_size = destpath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L191">191</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="191">&#43;				destpath = srealloc(destpath, destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L192">192</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="192">&#43;			}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L193">193</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="193">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L194">194</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="194">&#43;			free(tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L195">195</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="195">&#43;			return destpath;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L196">196</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="196">&#43;		}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L197">197</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="197"> 	}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L198">198</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="198"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L199">199</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="199"> 	/* Fall back to searching $PATH (or _CS_PATH in absence of $PATH). */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L200">200</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="200"> 	char *path = getenv(&#34;PATH&#34;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L201">201</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="201"> 	if (path == NULL) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L202">202</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="202"> 		/* _CS_PATH is typically something like &#34;/bin:/usr/bin&#34; */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L203">203</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="203">-		confstr(_CS_PATH, tmp, sizeof(tmp));</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L204">204</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="204">&#43;		while (confstr(_CS_PATH, tmp, tmp_size) &gt; tmp_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L205">205</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="205">&#43;			tmp_size = tmp_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L206">206</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="206">&#43;			tmp = srealloc(tmp, tmp_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L207">207</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="207">&#43;		}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L208">208</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="208"> 		sasprintf(&amp;path, &#34;:%s&#34;, tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L209">209</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="209"> 	} else {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L210">210</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="210"> 		path = strdup(path);</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L211">211</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="211">@@ -59,16 &#43;85,22 @@ const char *get_exe_path(const char *argv0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L212">212</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="212"> 		if ((component = strtok(str, &#34;:&#34;)) == NULL)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L213">213</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="213"> 			break;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L214">214</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="214"> 		str = NULL;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L215">215</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="215">-		snprintf(destpath, sizeof(destpath), &#34;%s/%s&#34;, component, argv0);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L216">216</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="216">&#43;		while(snprintf(destpath, destpath_size, &#34;%s/%s&#34;, component, argv0) &gt;= destpath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L217">217</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="217">&#43;			destpath_size = destpath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L218">218</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="218">&#43;			destpath = srealloc(destpath, destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L219">219</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="219">&#43;		}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L220">220</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="220"> 		/* Of course this is not 100% equivalent to actually exec()ing the</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L221">221</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="221"> 		 * binary, but meh. */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L222">222</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="222"> 		if (access(destpath, X_OK) == 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L223">223</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="223"> 			free(path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L224">224</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="224">&#43;			free(tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L225">225</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="225"> 			return destpath;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L226">226</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="226"> 		}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L227">227</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="227"> 	}</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L228">228</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="228">-	free(path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L229">229</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="229"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L230">230</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="230"> 	/* Last resort: maybe itâ€™s in /usr/bin? */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L231">231</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="231">-	return &#34;/usr/bin/i3-nagbar&#34;;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L232">232</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="232">&#43;	free(destpath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L233">233</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="233">&#43;	free(path);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L234">234</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="234">&#43;	free(tmp);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L235">235</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="235">&#43;	return sstrdup(&#34;/usr/bin/i3-nagbar&#34;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L236">236</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="236"> }</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/libi3/root_atom_contents.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L241">241</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="241">@@ -29,6 &#43;29,9 @@ char *root_atom_contents(const char *atomname) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L242">242</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="242">     xcb_intern_atom_reply_t *atom_reply;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L243">243</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="243">     int screen;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L244">244</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="244">     char *content;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L245">245</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="245">&#43;    /* Should be a multiple of 4 */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L246">246</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="246">&#43;    int path_max_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L247">247</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="247">&#43;    int prop_value_size = 0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L248">248</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="248"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L249">249</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="249">     if ((conn = xcb_connect(NULL, &amp;screen)) == NULL ||</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L250">250</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="250">         xcb_connection_has_error(conn))</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L251">251</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="251">@@ -46,10 &#43;49,24 @@ char *root_atom_contents(const char *atomname) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L252">252</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="252">     xcb_get_property_cookie_t prop_cookie;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L253">253</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="253">     xcb_get_property_reply_t *prop_reply;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L254">254</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="254">     prop_cookie = xcb_get_property_unchecked(conn, false, root, atom_reply-&gt;atom,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L255">255</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="255">-                                             XCB_GET_PROPERTY_TYPE_ANY, 0, PATH_MAX);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L256">256</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="256">&#43;                                             XCB_GET_PROPERTY_TYPE_ANY, 0, path_max_size / 4);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L257">257</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="257">     prop_reply = xcb_get_property_reply(conn, prop_cookie, NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L258">258</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="258">-    if (prop_reply == NULL || xcb_get_property_value_length(prop_reply) == 0)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L259">259</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="259">&#43;    if (prop_reply) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L260">260</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="260">&#43;        prop_value_size = xcb_get_property_value_length(prop_reply);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L261">261</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="261">&#43;        if (prop_reply &amp;&amp; prop_value_size &gt; 0 &amp;&amp; prop_value_size &lt; path_max_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L262">262</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="262">&#43;            path_max_size &#43;= (prop_reply-&gt;bytes_after / 4) &#43; 1;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L263">263</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="263">&#43;            prop_cookie = xcb_get_property_unchecked(conn, false, root, atom_reply-&gt;atom,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L264">264</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="264">&#43;                            XCB_GET_PROPERTY_TYPE_ANY, 0, path_max_size / 4);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L265">265</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="265">&#43;            prop_reply = xcb_get_property_reply(conn, prop_cookie, NULL);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L266">266</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="266">&#43;	    prop_value_size = 0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L267">267</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="267">&#43;	    if (prop_reply) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L268">268</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="268">&#43;                prop_value_size = xcb_get_property_value_length(prop_reply);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L269">269</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="269">&#43;	    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L270">270</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="270">&#43;        }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L271">271</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="271">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L272">272</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="272">&#43;    if (prop_reply == NULL || prop_value_size == 0)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L273">273</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="273">         return NULL;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L274">274</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="274">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L275">275</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="275">     if (prop_reply-&gt;type == XCB_ATOM_CARDINAL) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L276">276</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="276">         /* We treat a CARDINAL as a &gt;= 32-bit unsigned int. The only CARDINAL</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L277">277</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="277">          * we query is I3_PID, which is 32-bit. */</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/src/display_version.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L282">282</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="282">@@ -128,13 &#43;128,23 @@ void display_running_version(void) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L283">283</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="283">     printf(&#34;\rRunning i3 version: %s (pid %s)\n&#34;, human_readable_version, pid_from_atom);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L284">284</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="284"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L285">285</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="285"> #ifdef __linux__</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L286">286</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="286">-    char exepath[PATH_MAX],</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L287">287</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="287">-         destpath[PATH_MAX];</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L288">288</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="288">&#43;    size_t exepath_size = 1024,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L289">289</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="289">&#43;           destpath_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L290">290</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="290">     ssize_t linksize;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L291">291</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="291"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L292">292</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="292">-    snprintf(exepath, sizeof(exepath), &#34;/proc/%d/exe&#34;, getpid());</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L293">293</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="293">&#43;    char *exepath = smalloc(exepath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L294">294</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="294">&#43;    char *destpath = smalloc(destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L295">295</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="295"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L296">296</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="296">-    if ((linksize = readlink(exepath, destpath, sizeof(destpath))) == -1)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L297">297</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="297">&#43;    while (snprintf(exepath, exepath_size, &#34;/proc/%d/exe&#34;, getpid()) &gt;= exepath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L298">298</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="298">&#43;            exepath_size = exepath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L299">299</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="299">&#43;            exepath = srealloc(exepath, exepath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L300">300</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="300">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L301">301</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="301">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L302">302</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="302">&#43;    while ((linksize = readlink(exepath, destpath, destpath_size)) == destpath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L303">303</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="303">&#43;            destpath_size = destpath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L304">304</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="304">&#43;            destpath = srealloc(destpath, destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L305">305</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="305">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L306">306</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="306">&#43;    if (linksize == -1)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L307">307</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="307">         err(EXIT_FAILURE, &#34;readlink(%s)&#34;, exepath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L308">308</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="308"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L309">309</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="309">     /* readlink() does not NULL-terminate strings, so we have to. */</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L310">310</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="310">@@ -143,9 &#43;153,16 @@ void display_running_version(void) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L311">311</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="311">     printf(&#34;\n&#34;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L312">312</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="312">     printf(&#34;The i3 binary you just called: %s\n&#34;, destpath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L313">313</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="313"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L314">314</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="314">-    snprintf(exepath, sizeof(exepath), &#34;/proc/%s/exe&#34;, pid_from_atom);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L315">315</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="315">&#43;    while (snprintf(exepath, exepath_size, &#34;/proc/%s/exe&#34;, pid_from_atom) &gt;= exepath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L316">316</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="316">&#43;            exepath_size = exepath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L317">317</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="317">&#43;            exepath = srealloc(exepath, exepath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L318">318</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="318">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L319">319</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="319"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L320">320</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="320">-    if ((linksize = readlink(exepath, destpath, sizeof(destpath))) == -1)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L321">321</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="321">&#43;    while ((linksize = readlink(exepath, destpath, destpath_size)) == destpath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L322">322</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="322">&#43;        destpath_size = destpath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L323">323</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="323">&#43;        destpath = srealloc(destpath, destpath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L324">324</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="324">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L325">325</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="325">&#43;    if (linksize == -1)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L326">326</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="326">         err(EXIT_FAILURE, &#34;readlink(%s)&#34;, exepath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L327">327</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="327"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L328">328</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="328">     /* readlink() does not NULL-terminate strings, so we have to. */</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L329">329</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="329">@@ -159,7 &#43;176,10 @@ void display_running_version(void) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L330">330</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="330">     /* Since readlink() might put a &#34;(deleted)&#34; somewhere in the buffer and</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L331">331</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="331">      * stripping that out seems hackish and ugly, we read the processâ€™s argv[0]</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L332">332</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="332">      * instead. */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L333">333</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="333">-    snprintf(exepath, sizeof(exepath), &#34;/proc/%s/cmdline&#34;, pid_from_atom);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L334">334</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="334">&#43;    while (snprintf(exepath, exepath_size, &#34;/proc/%s/cmdline&#34;, pid_from_atom) &gt;= exepath_size) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L335">335</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="335">&#43;        exepath_size = exepath_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L336">336</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="336">&#43;        exepath = srealloc(exepath, exepath_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L337">337</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="337">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L338">338</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="338"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L339">339</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="339">     int fd;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L340">340</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="340">     if ((fd = open(exepath, O_RDONLY)) == -1)</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L341">341</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="341">@@ -169,6 &#43;189,9 @@ void display_running_version(void) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L342">342</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="342">     close(fd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L343">343</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="343"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L344">344</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="344">     printf(&#34;The i3 binary you are running: %s\n&#34;, destpath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L345">345</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="345">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L346">346</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="346">&#43;    free(exepath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L347">347</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="347">&#43;    free(destpath);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L348">348</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="348"> #endif</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L349">349</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="349"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L350">350</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="350">     yajl_free(handle);</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/src/main.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L355">355</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="355">@@ -488,18 &#43;488,25 @@ int main(int argc, char *argv[]) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L356">356</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="356"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L357">357</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="357">         /* The following code is helpful, but not required. We thus donâ€™t pay</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L358">358</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="358">          * much attention to error handling, non-linux or other edge cases. */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L359">359</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="359">-        char cwd[PATH_MAX];</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L360">360</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="360">         LOG(&#34;CORE DUMPS: You are running a development version of i3, so coredumps were automatically enabled (ulimit -c unlimited).\n&#34;);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L361">361</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="361">-        if (getcwd(cwd, sizeof(cwd)) != NULL)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L362">362</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="362">&#43;        size_t cwd_size = 1024;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L363">363</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="363">&#43;        char *cwd = smalloc(cwd_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L364">364</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="364">&#43;        while (getcwd(cwd, cwd_size) == NULL &amp;&amp; errno == ERANGE) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L365">365</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="365">&#43;                cwd_size = cwd_size * 2;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L366">366</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="366">&#43;                cwd = srealloc(cwd, cwd_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L367">367</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="367">&#43;        }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L368">368</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="368">&#43;        if (cwd != NULL)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L369">369</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="369">             LOG(&#34;CORE DUMPS: Your current working directory is \&#34;%s\&#34;.\n&#34;, cwd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L370">370</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="370">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L371">371</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="371">         int patternfd;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L372">372</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="372">         if ((patternfd = open(&#34;/proc/sys/kernel/core_pattern&#34;, O_RDONLY)) &gt;= 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L373">373</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="373">-            memset(cwd, &#39;\0&#39;, sizeof(cwd));</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L374">374</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="374">-            if (read(patternfd, cwd, sizeof(cwd)) &gt; 0)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L375">375</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="375">&#43;            memset(cwd, &#39;\0&#39;, cwd_size);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L376">376</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="376">&#43;            if (read(patternfd, cwd, cwd_size) &gt; 0)</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L377">377</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="377">                 /* a trailing newline is included in cwd */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L378">378</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="378">                 LOG(&#34;CORE DUMPS: Your core_pattern is: %s&#34;, cwd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L379">379</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="379">             close(patternfd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L380">380</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="380">         }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L381">381</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="381">&#43;        free(cwd);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L382">382</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="382">     }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L383">383</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="383"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L384">384</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="384">     LOG(&#34;i3 &#34; I3_VERSION &#34; starting\n&#34;);</pre>
  </td>
  </tr>


</table>
</div>


</div>

  </body>
</html>

