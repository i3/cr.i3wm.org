
<!DOCTYPE html>
<html>
  <head>
    <title>i3 Patch: Add background color to i3bar segments</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" media="screen" href="http://i3wm.org/css/style.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/public/stylesheets/main.css">
    <link rel="shortcut icon" type="image/png" href="http://i3wm.org/favicon.png">
    <script src="/public/js/jquery-1.9.0.min.js" type="text/javascript" charset="utf-8"></script>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
    
    
      <script src="/public/js/patch.js" type="text/javascript" charset="utf-8"></script>
    
  </head>
  <body>


<div id="main">
	<a href="/"><h1 id="title">i3 - improved tiling WM</h1></a>
				<ul id="nav">
						<li><a style="border-bottom: 2px solid #fff" href="/">Reviews</a></li>
						<li><a href="http://bugs.i3wm.org/">Bugs</a></li>
				</ul>
<br style="clear: both">

<div id="content">

<h1>Add background color to i3bar segments</h1>
<div style="float: right">
<p>
Patch status: rejected
</p>
<p>
Patch by S0lll0s
</p>
</div>



<p>
To apply this patch, use:<br>
<code>curl http://cr.i3wm.org/patch/418/raw.patch | git am</code>
</p>




<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/i3bar/include/common.h</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L16">16</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="16">@@ -38,6 &#43;38,7 @@ struct status_block {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L17">17</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="17">     i3String *full_text;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L18">18</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="18"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L19">19</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="19">     char *color;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L20">20</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="20">&#43;    char *bgcolor;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L21">21</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="21">     uint32_t min_width;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L22">22</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="22">     blockalign_t align;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L23">23</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="23"> </pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/i3bar/src/child.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L28">28</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="28">@@ -195,6 &#43;195,9 @@ static int stdin_string(void *context, const unsigned char *val, unsigned int le</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L29">29</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="29">     if (strcasecmp(ctx-&gt;last_map_key, &#34;color&#34;) == 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L30">30</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="30">         sasprintf(&amp;(ctx-&gt;block.color), &#34;%.*s&#34;, len, val);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L31">31</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="31">     }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L32">32</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="32">&#43;    if (strcasecmp(ctx-&gt;last_map_key, &#34;background_color&#34;) == 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L33">33</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="33">&#43;        sasprintf(&amp;(ctx-&gt;block.bgcolor), &#34;%.*s&#34;, len, val);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L34">34</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="34">&#43;    }</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L35">35</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="35">     if (strcasecmp(ctx-&gt;last_map_key, &#34;align&#34;) == 0) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L36">36</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="36">         if (len == strlen(&#34;left&#34;) &amp;&amp; !strncmp((const char*)val, &#34;left&#34;, strlen(&#34;left&#34;))) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L37">37</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="37">             ctx-&gt;block.align = ALIGN_LEFT;</pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/i3bar/src/xcb.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L42">42</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="42">@@ -178,7 &#43;178,8 @@ void refresh_statusline(void) {</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L43">43</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="43">             continue;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L44">44</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="44"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L45">45</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="45">         uint32_t colorpixel = (block-&gt;color ? get_colorpixel(block-&gt;color) : colors.bar_fg);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L46">46</td>
  <td width="100%" class="line del">
	  <b class="add-bubble"></b>
	  <pre data-nr="46">-        set_font_colors(statusline_ctx, colorpixel, colors.bar_bg);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L47">47</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="47">&#43;        uint32_t bgcolorpix = (block-&gt;bgcolor ? get_colorpixel(block-&gt;bgcolor) : colors.bar_bg);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L48">48</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="48">&#43;        set_font_colors(statusline_ctx, colorpixel, bgcolorpix);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L49">49</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="49">         draw_text(block-&gt;full_text, statusline_pm, statusline_ctx, x &#43; block-&gt;x_offset, 1, block-&gt;width);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L50">50</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="50">         x &#43;= block-&gt;width &#43; block-&gt;x_offset &#43; block-&gt;x_append;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L51">51</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="51"> </pre>
  </td>
  </tr>


</table>
</div>

<div style="border: 1px solid #ccc; margin: 1em; width: 880px; overflow-x: auto; background-color: #eaeaea; color: #000;">
<h2 style="margin: 0; padding: .5em; color: #000;">b/libi3/font.c</h2>
<table class="patch" cellpadding="0" cellspacing="0">


  <tr class="linerow">
  <td class="line-number" id="L56">56</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="56">@@ -29,6 &#43;29,9 @@ static xcb_visualtype_t *root_visual_type;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L57">57</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="57"> static double pango_font_red;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L58">58</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="58"> static double pango_font_green;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L59">59</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="59"> static double pango_font_blue;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L60">60</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="60">&#43;static double pango_bgfont_red;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L61">61</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="61">&#43;static double pango_bgfont_green;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L62">62</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="62">&#43;static double pango_bgfont_blue;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L63">63</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="63"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L64">64</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="64"> /* Necessary to track whether the dpi changes and trigger a LOG() message,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L65">65</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="65">  * which is more easily visible to users. */</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L66">66</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="66">@@ -120,6 &#43;123,10 @@ static void draw_text_pango(const char *text, size_t text_len,</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L67">67</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="67">     pango_layout_set_text(layout, text, text_len);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L68">68</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="68"> </pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L69">69</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="69">     /* Do the drawing */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L70">70</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="70">&#43;    cairo_set_source_rgb(cr, pango_bgfont_red, pango_bgfont_green, pango_bgfont_blue);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L71">71</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="71">&#43;    cairo_rectangle(cr, x, y, max_width, savedFont-&gt;height);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L72">72</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="72">&#43;    cairo_fill(cr);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L73">73</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="73">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L74">74</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="74">     cairo_set_source_rgb(cr, pango_font_red, pango_font_green, pango_font_blue);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L75">75</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="75">     pango_cairo_update_layout(cr, layout);</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L76">76</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="76">     pango_layout_get_pixel_size(layout, NULL, &amp;height);</pre>
  </td>
  </tr>



  <tr class="linerow">
  <td class="line-number" id="L77">77</td>
  <td width="100%" class="line hunk">
	  <b class="add-bubble"></b>
	  <pre data-nr="77">@@ -303,6 &#43;310,11 @@ void set_font_colors(xcb_gcontext_t gc, uint32_t foreground, uint32_t background</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L78">78</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="78">             pango_font_red = ((foreground &gt;&gt; 16) &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L79">79</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="79">             pango_font_green = ((foreground &gt;&gt; 8) &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L80">80</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="80">             pango_font_blue = (foreground &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L81">81</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="81">&#43;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L82">82</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="82">&#43;            /* Save the background font */</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L83">83</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="83">&#43;            pango_bgfont_red = ((background &gt;&gt; 16) &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L84">84</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="84">&#43;            pango_bgfont_green = ((background &gt;&gt; 8) &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L85">85</td>
  <td width="100%" class="line add">
	  <b class="add-bubble"></b>
	  <pre data-nr="85">&#43;            pango_bgfont_blue = (background &amp; 0xff) / 255.0;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L86">86</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="86">             break;</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L87">87</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="87"> #endif</pre>
  </td>
  </tr>

  <tr class="linerow">
  <td class="line-number" id="L88">88</td>
  <td width="100%" class="line ">
	  <b class="add-bubble"></b>
	  <pre data-nr="88">         default:</pre>
  </td>
  </tr>


</table>
</div>


</div>

  </body>
</html>

